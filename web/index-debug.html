<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>TG WebApp Debug</title>
  <style>
    html,body{margin:0;padding:0;height:100%;background:#fff;color:#000;font:16px/1.4 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif}
    pre{white-space:pre-wrap;word-break:break-word;padding:12px}
    .ok{color:#0a0}
    .bad{color:#a00}
  </style>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <pre id="out">init…</pre>
  <script>
    const out = document.getElementById('out');
    const log = (k,v,cls="")=>{
      const line = document.createElement('div');
      line.className = cls;
      line.textContent = (k? (k+": "):"") + (typeof v==="string"? v: JSON.stringify(v));
      out.appendChild(line);
    };
    const dump = (o)=>{ try{ return JSON.stringify(o,null,2) }catch(e){ return String(o) } };

    // 1) Заголовок
    out.textContent = "";
    log("userAgent", navigator.userAgent);

    // 2) Ловимо всі помилки прямо на екран
    window.addEventListener('error', e => log("window.error", `${e.message} @ ${e.filename}:${e.lineno}`, "bad"));
    window.addEventListener('unhandledrejection', e => log("unhandledrejection", dump(e.reason), "bad"));

    // 3) Перевіряємо доступність WebApp API
    const tg = window.Telegram?.WebApp;
    log("location.origin", location.origin);
    log("location.href", location.href);
    log("has Telegram", !!window.Telegram, !!window.Telegram ? "ok":"bad");
    log("has WebApp", !!tg, !!tg ? "ok":"bad");
    log("platform", tg?.platform || "null");
    log("colorScheme", tg?.colorScheme || "null");

    // 4) Спробуємо викликати ready/expand обережно
    try { tg?.ready(); log("tg.ready()", "ok", "ok"); } catch(e){ log("tg.ready() error", String(e), "bad"); }
    try { tg?.expand(); log("tg.expand()", "ok", "ok"); } catch(e){ log("tg.expand() error", String(e), "bad"); }

    // 5) Показуємо initData (довжину) і user
    const len = (tg?.initData || "").length || 0;
    log("initData.length", String(len), len>0? "ok":"bad");
    log("initDataUnsafe.user", tg?.initDataUnsafe?.user || null, tg?.initDataUnsafe?.user ? "ok":"bad");

    // 6) Додаткова службова інфа
    log("visibilityState", document.visibilityState);
    document.addEventListener('visibilitychange', ()=>log("visibilityState change", document.visibilityState));
  </script>
</body>
</html>
